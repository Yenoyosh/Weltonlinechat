<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>World Wide Onlinechat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="/socket.io/client-dist/socket.io.min.js"></script>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    body { margin:0; background:#fff; color:#111; }
    header { padding:12px 16px; border-bottom:1px solid #e5e5e5; display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .room-label { font-weight:600; }
    input[type="text"] { padding:8px 10px; border:1px solid #ddd; border-radius:6px; min-width:220px; }
    button { padding:8px 12px; border:1px solid #ddd; background:#f8f8f8; border-radius:6px; cursor:pointer; }
    button:hover { background:#f2f2f2; }
    #log { height: calc(100vh - 160px); overflow-y:auto; padding:12px 16px; }
    .sys { color:#555; font-style:italic; margin:6px 0; }
    .chat { margin:6px 0; }
    .name { font-weight:600; margin-right:6px; }
    .priv { background:#fffbe6; border:1px solid #f5e6a8; padding:8px; border-radius:6px; margin:6px 0; }
    footer { display:flex; gap:8px; padding:12px 16px; border-top:1px solid #e5e5e5; }
    #roomNow { font-weight:700; }
  </style>
</head>
<body>
  <header>
    <span class="room-label">Raum:</span>
    <input id="roomInput" type="text" placeholder="Global" />
    <button id="roomBtn">Wechseln</button>
    <span>Aktueller Raum: <span id="roomNow">Global</span> (Standard ist Global)</span>
  </header>

  <div id="log" aria-live="polite"></div>

  <footer>
    <input id="msg" type="text" placeholder="Nachricht oder Befehl (Tipp: /help)" style="flex:1" />
    <button id="send">Senden</button>
  </footer>

  <script>
    const socket = io();
    const log = document.getElementById("log");
    const msg = document.getElementById("msg");
    const send = document.getElementById("send");
    const roomInput = document.getElementById("roomInput");
    const roomBtn = document.getElementById("roomBtn");
    const roomNow = document.getElementById("roomNow");

    function line(cls, html) {
      const div = document.createElement("div");
      div.className = cls;
      div.innerHTML = html;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    socket.on("system", (text) => line("sys", "⚙ " + text));
    socket.on("roomUpdate", (room) => { roomNow.textContent = room; roomInput.value = room; });

    socket.on("chat", (m) => {
      if (m.room !== roomNow.textContent) return; // nur aktuellem Raum anzeigen
      line("chat", `<span class="name">${m.from}:</span> ${m.text}`);
    });

    socket.on("private", (m) => {
      line("priv", m.display || (`${m.from} flüstert dir zu: ${m.text}`));
    });

    send.addEventListener("click", () => {
      const t = msg.value.trim();
      if (!t) return;
      socket.emit("message", t);
      msg.value = "";
      msg.focus();
    });
    msg.addEventListener("keydown", (e) => {
      if (e.key === "Enter") { send.click(); }
    });

    roomBtn.addEventListener("click", () => {
      const r = roomInput.value.trim() || "Global";
      socket.emit("changeRoom", r);
    });
    roomInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") roomBtn.click();
    });
  </script>
</body>
</html>
