<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Weltchat ‚Äì Klassisches Layout</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #ffffff; color: #000000; }
    h1 { margin-bottom: 10px; }
    #roomSection { margin-bottom: 10px; }
    #roomInput { padding: 5px; width: 200px; }
    #joinRoomBtn { padding: 6px; }
    #log { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; background: #f9f9f9; border-radius: 5px; margin-bottom: 10px; }
    #msgForm { display: flex; gap: 10px; }
    #msgInput { flex: 1; padding: 6px; }
    #sendBtn { padding: 6px 12px; }
    .sys { color: #555; font-style: italic; margin: 4px 0; white-space: pre-line; }
    .priv { color: #800080; margin: 4px 0; }
    .msg { margin: 4px 0; }
    .msg time { font-size: 12px; opacity: .7; margin-left: 5px; }
  </style>
</head>
<body>
  <h1>üåç Weltchat</h1>

  <div id="roomSection">
    <label for="roomInput">Raum:</label>
    <input id="roomInput" type="text" value="Global" />
    <button id="joinRoomBtn">Beitreten</button>
  </div>

  <div id="log"></div>

  <form id="msgForm" autocomplete="off">
    <input id="msgInput" type="text" placeholder="Nachricht oder Befehl (/help f√ºr Liste) ..." />
    <button id="sendBtn" type="submit">Senden</button>
  </form>

  <div id="callJoinSection" style="display:none; margin-top:10px;">
<button id="joinCallBtn">üîä Dem offenen Audio-Call beitreten</button>
    <!-- NEU (nur hinzuf√ºgen) -->
<audio id="remoteAudio" autoplay playsinline></audio>

</div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/call.js"></script>
  <script>
    const socket = io();
    const log = document.getElementById("log");
    const roomInput = document.getElementById("roomInput");
    const joinBtn = document.getElementById("joinRoomBtn");
    const msgForm = document.getElementById("msgForm");
    const msgInput = document.getElementById("msgInput");

    function addLine(text, cls = "") {
      const div = document.createElement("div");
      div.className = cls;
      div.innerHTML = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    function fmtTime(ts) {
      return new Date(ts).toLocaleTimeString();
    }

    socket.on("system", (msg) => addLine("‚öô " + msg, "sys"));
    socket.on("chat", (msg) => {
      addLine(`<b>${msg.from}</b>: ${msg.text} <time>${fmtTime(msg.ts)}</time>`, "msg");
    });
    socket.on("private", (msg) => {
      addLine(`${msg.from} fl√ºstert dir zu: ${msg.text} <time>${fmtTime(msg.ts)}</time>`, "priv");
    });
    socket.on("roomUpdate", (room) => {
      roomInput.value = room;
    });

    msgForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = msgInput.value.trim();
      if (!text) return;
      socket.emit("message", text);
      msgInput.value = "";
      msgInput.focus();
    });

    joinBtn.addEventListener("click", () => {
      const roomName = roomInput.value.trim() || "Global";
      socket.emit("changeRoom", roomName);
    });

    const callJoinSection = document.getElementById("callJoinSection");
const joinCallBtn = document.getElementById("joinCallBtn");

socket.on("system", (msg) => {
if (msg.includes("offenen Audio-Call gestartet")) {
callJoinSection.style.display = "block";
}
if (msg.includes("Audio-Call wurde beendet")) {
callJoinSection.style.display = "none";
}
});

joinCallBtn.addEventListener("click", () => {
const room = roomInput.value.trim() || "Global";
window.initCall(room);
});
  </script>
</body>
</html>
